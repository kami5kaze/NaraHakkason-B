import os
from flask import Flask,request,abort
from linebot import LineBotApi,WebhookHandler
from linebot.exceptions import InvalidSignatureError,LineBotApiError
from linebot.models import (RichMenu,RichMenuArea,RichMenuBounds,RichMenuSize)
from linebot.models import TextSendMessage
from linebot.models.actions import PostbackAction
from linebot.models import PostbackEvent

app=Flask(__name__)

LineAccessToken = 'UYTYlaQ/QzttY1GSJUQ2MC2BJVbghcHQ/6PCyHs4Kvn5cK7VUD+FRGZfCGVRp/UGYOz61BNXzIyjd7Zdr0ilzBCmsys6QAwN8Y1dSVDu4UOvF/sJDP0B3vFuBnvXzbCPjV03DNQAVCKlApWiqDr25gdB04t89/1O/w1cDnyilFU='

line_bot_api=LineBotApi(LineAccessToken)
handler= WebhookHandler('38c652386d46276dfaa362a222390390')


richMenuImagePath='/Users/kamikaze/product/NaraHakkason/NaraHakkason-B/LINE_bot_venv/images/richmenu_1710784918598.jpg'

with open(richMenuImagePath, 'rb') as f:
    richMenuImageContent = f.read()



richMenuCreate=RichMenu(
    size=RichMenuSize(width=2500,height=1686),
    selected= True,
    name= 'richmenu',
    chat_bar_text='メニュー',
    areas=[
        RichMenuArea(
            bounds=RichMenuBounds( x = 0,y = 0,width=833,height=843),
            action=PostbackAction(data='1'),
        ),
        RichMenuArea(
            bounds=RichMenuBounds( x = 834,y = 0,width=833,height=843),
            action=PostbackAction(data='2')
        ),
        RichMenuArea(
            bounds=RichMenuBounds( x = 1668,y = 0,width=833,height=843),
            action=PostbackAction(data='3')
        ),
        RichMenuArea(
            bounds=RichMenuBounds(x=0,y=844,width=2500,height=843),
            action=PostbackAction(data='4'),
        ),
    ]
    
)

@app.route("/callback", methods=['POST'])
def callback():
    signature = request.headers['X-Line-Signature']
    body = request.get_data(as_text=True)
    try:
        handler.handle(body, signature)
    except InvalidSignatureError:
        abort(400)
    return 'OK'

richMenuId = line_bot_api.create_rich_menu(rich_menu=richMenuCreate)

try:
    line_bot_api.set_rich_menu_image(rich_menu_id=richMenuId, content_type='image/jpeg', content=richMenuImageContent)
    line_bot_api.set_default_rich_menu(richMenuId)
except LineBotApiError as e:
    print(e)

if __name__ == "__main__":
    port = int(os.getenv("port",8000))
    app.run(host="0.0.0.0",port=port,debug=False)
